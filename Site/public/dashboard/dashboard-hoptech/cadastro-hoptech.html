<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Cadastro | HopTech</title>
    <link rel="shortcut icon" href="../../assets/images/logosProjeto/HopTech-dark.png" type="image/x-icon">

    <link rel="stylesheet" href="css/cadastroHopTech.css">
</head>

<body>
    <div class="div_menu_lateral">
        <img src="../../assets/images/logosProjeto/HopTech-dark.png" class="logo_hoptech" alt="Logo da HopTech">
        <button onclick="irParaDashboard(); return false">
            <img src="../../assets/images/icons/dashboard.png" class="icons_menu" alt="icone dashboard">
            Dashboard
        </button>
        <button class="pageAtual" onclick="irParaCadastro(); return false">
            <img src="../../assets/images/icons/icon_cadastro.png" width="35" class="icons_menu" alt="icone cadastro">
            Cadastro de empresa
        </button>
        <button onclick="irParaCadastroPlantacao(); return false">
            <img src="../../assets/images/icons/notification.png" width="35" class="icons_menu" alt="Ícone de caixa de entrada">
            Plantação e Sensores
        </button>
        <button onclick="irParaNotificacoes(); return false">
            <img src="../../assets/images/icons/notification.png" width="30" class="icons_menu" alt="Ícone de caixa de entrada">
            Notificações
        </button>
        <footer>
            <a href="../../nextpoint-site/index.html"><img src="../../assets/images/logosProjeto/NEXTpoint.png" class="logo_empresa"
                    alt="Logo da NEXTPOINT"></a>
            © 2023 HopTech
        </footer>
    </div>
    <div class="div_conteiner_conteudo">
        <div class="div_menu_top">
            <div><!--  --></div>
            <h3 class="titleDashboardCliente">Gerenciamento - HopTech</h3>
            <button class="botao_sair" onclick="sair(); return false">Sair</button>
        </div>
        <div class="container_principal">
            <div class="titleBox">
                <h2>Cadastro de empresa</h1>
            </div>
            <div class="input-container">
                <div class="inputBox">
                    <div class="inputUnica">
                        <label for="input_empresa">Nome da empresa*</label>
                        <input type="text" id="input_empresa">
                    </div>
                </div>
                <div class="inputBox">
                    <div class="inputDupla">
                        <label for="input_telefone">Telefone*</label>
                        <input type="number" id="input_telefone">
                    </div>
                    <div class="inputDupla">
                        <label for="input_cnpj">CNPJ*</label>
                        <input id="input_cnpj" type="number">
                    </div>
                </div>
                <div class="inputBox">
                    <div class="inputDupla">
                        <label for="input_email">Email*</label>
                        <input id="input_email" type="text">
                    </div>
                    <div class="inputDupla">
                            <label for="input_confirmar">Confirmar Email*</label>
                            <input id="input_confirmar" type="text">
                    </div>
                </div>
                <div class="inputBox">
                    <div class="inputDupla">
                        <label for="input_cep">CEP*</label>
                        <input id="input_cep" type="number">
                    </div>
                    <div class="inputDupla">
                        <label for="input_estado">Estado*</label>
                        <input id="input_estado" type="text">
                    </div>
                </div>
                <div class="inputBox">
                    <div class="inputDupla">
                        <label for="input_cidade">Cidade*</label>
                        <input id="input_cidade" type="text">
                    </div>
                    <div class="inputDupla">
                        <label for="input_bairro">Bairro*</label>
                        <input id="input_bairro" type="text">
                    </div>
                </div>
                <div class="inputBox">
                    <div class="inputDupla">
                        <label for="input_rua">Rua*</label>
                        <input id="input_rua" type="text">
                    </div>
                    <div class="inputDupla">
                        <label for="input_complemento">Complemento</label>
                        <input type="text" id="input_complemento">
                    </div>
                </div>
                <div class="inputBox">
                    <div class="inputDupla">
                        <label for="input_usuario">Usuario*</label>
                        <input id="input_usuario" type="text">
                    </div>
                    <div class="inputDupla">
                        <label for="input_senha">Senha*</label>
                        <input id="input_senha" type="password">
                    </div>
                </div>
            </div>
            <div class="buttonBox">
                <button onclick="cadastrar()">Cadastrar</button>
            </div>
        </div>
</body>

</html>
<!-- Importando a API de alertas "SweetAlert2": -->
<link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bootstrap-4/bootstrap-4.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

<script src="js/cadastro-hoptech.js"></script>
<script src="js/redirect-admin.js"></script>
<script>
    function cadastrar(){
        aguardar();
        var nomeEmpresa = input_empresa.value;
        var telefoneEmpresa = input_telefone.value;
        var cnpjEmpresa = input_cnpj.value;
        var email = input_email.value;
        var confirmarEmail = input_confirmar.value;
        var cepEmpresa = input_cep.value;
        var estadoEmpresa = input_estado.value;
        var cidadeEmpresa = input_cidade.value; 
        var bairroEmpresa = input_bairro.value;
        var ruaEmpresa = input_rua.value;
        var complementoEmpresa = input_complemento.value;
        var usuarioEmpresa = input_usuario.value;
        var senhaEmpresa = input_senha.value;

        let alertMessage = ''

        if(nomeEmpresa == '' || telefoneEmpresa == '' || cnpjEmpresa == '' ||  email == '' || confirmarEmail == '' || cepEmpresa == '' || estadoEmpresa == '' || cidadeEmpresa == '' || bairroEmpresa == '' || ruaEmpresa == '' || usuarioEmpresa == '' || senhaEmpresa == ''){
            Swal.fire({
                position: 'center',
                icon: 'error',
                title: 'Campo obrigatório vazio.',
                showConfirmButton: true,
            });

            finalizarAguardar();
            return false;
        } else if (email != confirmarEmail) {
                alertMessage += '• Email: Campos email e confirmação email não estão iguais.\n'
            } else if(cepEmpresa.length != 8){
                alertMessage += '• CEP: Quantidade de dígitos inválida. \n'
            } else if(cnpjEmpresa.length != 14){
                alertMessage += '• CNPJ: Quantidade de dígitos inválida. \n'
            } else if(telefoneEmpresa.length < 8 || telefoneEmpresa.length > 9){
                alertMessage += '• Telefone: Quantidade de dígitos inválida. \n'
            } else {
            setInterval(sumirMensagem, 5000)
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeEmpresaServer: nomeEmpresa,
                emailEmpresaServer: email,
                usuarioServer, usuarioEmpresa,
                senhaServer: senhaEmpresa,
                cepEmpresaServer: cnpjEmpresa,
                estadoEmpresaServer: estadoEmpresa,
                cidadeEmpresaServer: cidadeEmpresa,
                bairroEmpresaServer: bairroEmpresa,
                ruaEmpresaServer: ruaEmpresa,
                complementoEmpresaServer: complementoEmpresa
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cardErro.style.display = "block";

                Swal.fire({
                    position: 'center',
                    icon: 'success',
                    title: 'Cadastro feito com sucesso.',
                    showConfirmButton: true,
                });

                setTimeout(() => {
                    window.location = "login.html";
                }, "2000")

                limparFormulario();
                finalizarAguardar();
            } else {
                throw (Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: 'Houve um erro ao tentar se cadastrar.',
                    showConfirmButton: true,
                }));
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    function sumirMensagem() {
        cardErro.style.display = "none"
    }
</script>